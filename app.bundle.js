(()=>{"use strict";var t,e={306:(t,e,i)=>{var n=i(569);i(972),i(409),i(928),i(132);class o{constructor(){this.sceneFigures=new Array,this.multiselectEnable=!1,this.selectedFigures=new Array}static getInstance(){return o.instance||(o.instance=new o),o.instance}getSceneFigures(){return this.sceneFigures}setSceneFigures(t){this.sceneFigures=t}removeSceneFigure(t){this.sceneFigures.filter((e=>e.htmlRef.innerHTML!==t.innerHTML))}getMultiselectEnable(){return this.multiselectEnable}setMultiselectEnable(t){this.multiselectEnable=t}getSelectedFigures(){return this.selectedFigures}setSelectedFigures(t){this.selectedFigures=t}deselectFigure(t){this.selectedFigures=this.selectedFigures.filter((e=>e.htmlRef.innerHTML!==t.innerHTML))}resetState(){this.setSceneFigures([]),this.setSelectedFigures([])}}const s="selectable-figure-scene";const r="assets/images/textures/",c=".jpg",a={GRASS:r+"grass"+c,PAPER:r+"paper"+c,STONE:r+"stone"+c,WALLBRICK:r+"wall-brick"+c,WOODEN:r+"wooden"+c},l="clone-podium",h="selectable-figure-palette";function u(t){const e=t.toString(16);return 1==e.length?"0"+e:e}function d(t,e){e&&Object.keys(e).length&&Object.keys(e).forEach((i=>{const n=e[i];t.setAttribute(i,n)}))}function p(t){const e=document.createElement("a-gui-flex-container");return d(e,{"flex-direction":"column","justify-content":"center","align-items":"normal","component-padding":"0.1",opacity:"0.7",width:"0.8",height:"0.25",position:"0 0 0.05 0"}),d(e,t),e}function f(t,e){const i=document.createElement("a-gui-label");return d(i,{width:"1",height:"0.2",value:t,"font-family":"assets/fonts/PressStart2P-Regular.ttf","font-size":"80px",margin:"0 0 0.05 0",opacity:"0.8","font-color":"white","background-color":"#363184"}),d(i,e),i}function g(t){const e=document.createElement("a-gui-button");return d(e,{width:"0.2",height:"0.2","font-size":"80px","font-color":"white","background-color":"#606e9e","hover-color":"#8791af",opacity:"0.8"}),d(e,t),e}function m(t){const e=document.createElement("a-gui-toggle");return d(e,{width:"0.7",height:"0.2","font-size":"70px","font-color":"white",margin:"0 0 0.05 0",opacity:"0.8","background-color":"#50687d"}),d(e,t),e}function b(t,e){const i=f("Opacity",{margin:"-0.05 0 0.15 0"});t.appendChild(i);const n=function(t){const e=document.createElement("a-gui-slider");return d(e,{width:"2.5",height:"0.25",percent:"0.99",margin:"0 0 0.05 0",opacity:"0.8","handle-outer-radius":"0.1","handle-inner-radius":"0.07","background-color":"#50687d"}),d(e,t),e}({percent:"0.3"}),o="slideOpacity"+(new Date).getTime();n.setAttribute("onclick",o),window[o]=function(t,i){t.stopPropagation(),t instanceof CustomEvent&&e.setOpacity(i)},t.appendChild(n)}var w=i(486);const y={red:0,green:0,blue:0};let v,A,E,C,R,S;function k(t,e){A=t,v=e;const i=f("Color");A.appendChild(i),["red","green","blue"].forEach((t=>{!function(t){const e=p({"flex-direction":"row",margin:"0 0 0.01 0",width:"0.4",height:"0.2"});F(t,"decrease",e),F(t,"increase",e),A.appendChild(e)}(t)}))}function F(t,e,i){const n=g({value:"increase"===e?"+":"-","background-color":t}),o=e+t+(new Date).getTime();n.setAttribute("onclick",o);const s=(0,w.cloneDeep)(v);window[o]=function(i){if(i.stopPropagation(),i instanceof CustomEvent){const i=25,r="increase"===e?i:-i,c=y[t]+r;c>=0&&c<=255&&(y[t]=c);const{red:a,green:l,blue:h}=y,d=(n=l,o=h,"#"+u(a)+u(n)+u(o));s.setColor(d)}var n,o},i.appendChild(n)}function T(t,e){C=t,E=e;const i=f("Size");C.appendChild(i),function(){const t=p({"flex-direction":"row",margin:"0 0 0.05 0",width:"0.4",height:"0.2"});O("decrease",t),O("increase",t),C.appendChild(t)}()}function O(t,e){const i=g({value:"increase"===t?"+":"-"}),n=t+"size"+(new Date).getTime();i.setAttribute("onclick",n);const s=(0,w.cloneDeep)(E);window[n]=function(e){if(e.stopPropagation(),e instanceof CustomEvent){const e=.2,i="increase"===t?1+e:1-e,n=o.getInstance().getSelectedFigures();s?s.resize(i):!s&&n.length&&n.forEach((t=>t.resize(i)))}},e.appendChild(i)}function x(t,e){R=t,S=e,function(){const t=p({"flex-direction":"column",margin:"0 0 0.05 0",width:"0.8",height:"0.4"});(function(t){const e=g({value:"Remove texture",width:.8}),i="removeTexture"+(new Date).getTime();e.setAttribute("onclick",i),window[i]=function(t){t.stopPropagation(),t instanceof CustomEvent&&S.setMaterial(null)},t.appendChild(e)})(t),function(t){const e=g({value:"Change texture",width:.8}),i="changeTexture"+(new Date).getTime();e.setAttribute("onclick",i);const n=Object.keys(a);let o=0;window[i]=function(t){if(t.stopPropagation(),t instanceof CustomEvent){o=o+1>n.length-1?0:o+1;const t=n[o],e={src:a[t],roughness:1};S.setMaterial(e)}},t.appendChild(e)}(t),R.appendChild(t)}()}const P=o.getInstance();class M{constructor(t){this.figure=t,this.createMenuContainer(),function(t,e){const i=g({value:"X",margin:"0 0 0.1 0","background-color":"#c41b1b"}),n="closeMenu"+(new Date).getTime();i.setAttribute("onclick",n),window[n]=function(t){t.stopPropagation(),t instanceof CustomEvent&&e.htmlRef.childNodes[0].setAttribute("visible","false")},t.appendChild(i)}(this.entityRef,t),k(this.entityRef,t),b(this.entityRef,t),T(this.entityRef,t),function(t,e){const i=m({value:"Wireframe"}),n="setWireframe"+(new Date).getTime();i.setAttribute("onclick",n),window[n]=function(t){if(t.stopPropagation(),t instanceof CustomEvent){const t="true"===e.htmlRef.getAttribute("wireframe");e.setWireframe(!t)}},t.appendChild(i)}(this.entityRef,t),x(this.entityRef,t),function(t,e){const i=m({value:"Shadow"}),n="setShadow"+(new Date).getTime();i.setAttribute("onclick",n),window[n]=function(t){if(t.stopPropagation(),t instanceof CustomEvent){const t=e.htmlRef.getAttribute("shadow"),i=Boolean(null==t?void 0:t.receive);e.setShadow(!i)}},t.appendChild(i)}(this.entityRef,t),function(t,e){const i=g({value:"Clone",margin:"0 0 0.05 0",width:"0.5"}),n="closeMenu"+(new Date).getTime();i.setAttribute("onclick",n),window[n]=function(t){if(t.stopPropagation(),t instanceof CustomEvent){const t=document.querySelector("#clone-podium");j(e.htmlRef,t)}},t.appendChild(i)}(this.entityRef,t),function(t,e){const i=m({value:"Gravity"}),n="setPhysics"+(new Date).getTime();i.setAttribute("onclick",n),window[n]=function(t){t.stopPropagation(),t instanceof CustomEvent&&(Boolean(e.htmlRef.getAttribute("ammo-body"))?e.setPhysics(null):e.setPhysics({body:"dynamic",shape:"box"}))},t.appendChild(i)}(this.entityRef,t),function(t,e){const i=g({value:"Delete",margin:"0 0 0.05 0",width:"0.5","background-color":"red"}),n="deleteFigure"+(new Date).getTime();i.setAttribute("onclick",n),window[n]=function(t){t.stopPropagation(),t instanceof CustomEvent&&(P.removeSceneFigure(e.htmlRef),P.deselectFigure(e.htmlRef),e.htmlRef.remove())},t.appendChild(i)}(this.entityRef,t)}createMenuContainer(){this.entityRef=p({width:"2.6",height:"4",position:"0 2.3 0","panel-color":"#93b2e8"}),this.figure.htmlRef.appendChild(this.entityRef),this.entityRef.setAttribute("visible","false")}}const L=o.getInstance();function D(t){let e;switch(t.tagName.toLowerCase()){case"a-sphere":e=new U({radius:0});break;case"a-cone":e=new q({"radius-bottom":0,height:0});break;case"a-box":e=new V({width:0,height:0,depth:0});break;case"a-cylinder":e=new G({radius:0,height:0})}return Object.getOwnPropertyNames(e).forEach((i=>{e[i]=t.getAttribute(i)})),e.htmlRef=t,e}function j(t,e){const i=t.cloneNode();i.setAttribute("position","0 0 1.5"),i.setAttribute("rotation","90 0 0"),i.removeAttribute(h),i.setAttribute(s,"");const n={hoverable:!1,draggable:!0};z(i,n),W(i,n);const o=D(i);o.setPhysics({body:"dynamic",shape:"box"}),setTimeout((()=>o.setPhysics(null)),2e3),new M(o),L.getSceneFigures().push(o),e.appendChild(i)}function _(t,e){t.setAttribute("shadow",`receive: ${e}`)}function I(t,e){e?((null==e?void 0:e.body)&&t.setAttribute("ammo-body",`type: ${e.body}`),(null==e?void 0:e.shape)&&t.setAttribute("ammo-shape",`type: ${e.shape}`)):(t.removeAttribute("ammo-body"),t.removeAttribute("ammo-shape"))}function N(t){const e=L.getSceneFigures(),i=L.getSelectedFigures(),n=Boolean(i.find((e=>e.htmlRef.innerHTML===t.innerHTML))),o=e.find((e=>e.htmlRef.innerHTML===t.innerHTML));n?(L.deselectFigure(t),t.setAttribute("color",o.color)):(i.push(o),t.setAttribute("color","cyan"))}function H(t){const e=Object.keys(t);let i="";return e.forEach((e=>{i+=`${e}: ${String(t[e])}; `})),i}function z(t,e){e.hoverable&&t.setAttribute("hoverable",""),e.draggable&&(t.setAttribute("grabbable",""),t.setAttribute("draggable",""))}function W(t,e){e.hoverable&&(t.setAttribute("event-set__hoveron","_event: hover-start; material.opacity: 0.8; transparent: true"),t.setAttribute("event-set__hoveroff","_event: hover-end; material.opacity: 1; transparent: false")),e.draggable&&(t.setAttribute("event-set__dragdrop","event: drag-drop"),t.setAttribute("event-set__dragon","_event: dragover-start;"),t.setAttribute("event-set__dragoff","_event: dragover-end;"))}function B(t,e,i,n={draggable:!1,hoverable:!1,custom:""}){const o=document.createElement(t.primitive);o.setAttribute("position",e);Object.keys(t).forEach((e=>{switch(e){case"shadow":const i=Boolean(t.shadow);i&&_(o,i);break;case"physics":const n=t.physics;I(o,n);break;default:"primitive"!==e&&o.setAttribute(e,t[e])}})),o.setAttribute("class","selectable-superhands"),n.custom&&o.setAttribute(n.custom,""),z(o,n),W(o,n),i.appendChild(o),t.htmlRef=o}class ${constructor(t){this.color="white",this.shadow=!1,this.opacity=1,this.wireFrame=!1,this.physics=null;const{primitive:e,id:i,color:n,material:o,shadow:s,opacity:r,wireFrame:c,physics:a}=t;this.primitive=e,i&&(this.id=i),n&&(this.color=n),o&&(this.material=H(o)),s&&(this.shadow=s),r&&(this.opacity=r),c&&(this.wireFrame=c),a&&(this.physics=a)}setColor(t){this.color=t,this.htmlRef.setAttribute("color",t)}setMaterial(t){if(this.material=t,t){const e=H(t);"white"!==this.color&&this.setColor("white"),this.htmlRef.setAttribute("material",e)}else this.htmlRef.removeAttribute("material")}setOpacity(t){this.opacity=t,this.htmlRef.setAttribute("opacity",t.toString())}resize(t){this.htmlRef.object3D.scale.multiplyScalar(t)}setWireframe(t){this.wireFrame=t,this.htmlRef.setAttribute("wireframe",String(t))}setShadow(t){this.shadow=t,_(this.htmlRef,t)}setPhysics(t){this.physics=t,I(this.htmlRef,t)}}class q extends ${constructor(t){t.primitive="a-cone",super(t),this["radius-bottom"]=t["radius-bottom"],this.height=t.height}}class G extends ${constructor(t){const{height:e,radius:i}=t;t.primitive="a-cylinder",super(t),this.height=e,this.radius=i}}class U extends ${constructor(t){t.primitive="a-sphere",super(t),this.radius=t.radius}}class V extends ${constructor(t){const{height:e,width:i,depth:n}=t;t.primitive="a-box",super(t),this.height=e,this.width=i,this.depth=n}}class K extends ${constructor(t){const{height:e,width:i,rotation:n}=t;t.primitive="a-plane",super(t),this.height=e,this.width=i,this.rotation=n}}class X{constructor(){this.sceneEl=document.querySelector("a-scene")}static getInstance(){return X.instance||(X.instance=new X),X.instance}getSceneEl(){return this.sceneEl}}class J{constructor(t){this.primitive="a-entity",this.props=t,this.createLightEntity()}createLightEntity(){this.htmlRef=document.createElement(this.primitive),this.setLightConfig();X.getInstance().getSceneEl().appendChild(this.htmlRef)}setLightConfig(){if(this.htmlRef&&this.props&&Object.keys(this.props)){const t=Object.assign({},this.props),e=t.position;delete t.position;const i=H(t);this.htmlRef.setAttribute("light",i),this.htmlRef.setAttribute("position",e)}}setProps(t){t&&Object.keys(t)&&(this.props=t,this.setLightConfig())}setActive(t){t?this.setLightConfig():this.htmlRef.setAttribute("light","")}}class Q{constructor(t,e){this.componentId="figures-palette",this.figures=e||new Array,this.appendPalette(t),setTimeout((()=>{!function(){const t={dependencies:["raycaster"],init:function(){const t=this.el;let e=null;this.el.addEventListener("click",(function(i){if(i.stopPropagation(),i instanceof MouseEvent)if(e){if((new Date).getTime()-e<400){const e=document.querySelector("#clone-podium");j(t,e)}e=null}else e=(new Date).getTime()}))}};(0,n.registerComponent)(h,t)}(),this.appendFigures()}),0)}appendPalette(t){const e=X.getInstance().getSceneEl();this.entityRef=document.createElement("a-entity"),this.entityRef.setAttribute("id",this.componentId),Object.keys(t).forEach((e=>{this.entityRef.setAttribute(e,t[e])})),e.appendChild(this.entityRef)}appendFigures(){const{x:t,y:e,z:i}=this.entityRef.getAttribute("position");B(new K({height:1.3,width:4,rotation:"0 0 0",color:"#211e1e"}),t-.5+" 0 0",this.entityRef),this.figures.forEach(((e,i)=>{const n={hoverable:!0,draggable:!1,custom:h};B(e,t+2-(i+1)+" 0 0",this.entityRef,n)}))}}var Y=i(755),Z=i.n(Y);const tt=o.getInstance();function et(t){const e=document.createElement("a-entity");e.setAttribute("rotation","90 0 0"),e.setAttribute("position","0 0 1"),e.innerHTML=t,Z()("#clone-podium").html(e),function(){tt.resetState();Array.from(Z()("#clone-podium a-entity").children()).forEach(((t,e)=>{const i=D(t);new M(i),tt.getSceneFigures().push(i),t.setAttribute("position",-.8*e+1.8+" 0 1")}))}()}function it(){const t=Array.from(Z()("#clone-podium").children());let e="";t.forEach((t=>{const i=function(t){const e=t.cloneNode(),i=document.createElement("div");return i.appendChild(e),i.innerHTML.toString()}(t);e+=i}));const i=document.createElement("a"),n=`scene_${(new Date).toISOString()}.html`,o=new Blob([e],{type:"text/html"});i.href=URL.createObjectURL(o),i.download=n,i.click()}let nt;function ot(t){nt=t,function(){const t=p({"flex-direction":"row",margin:"0 0 0.05 0",width:"0.8",height:"0.2"});(function(t){const e=g({value:"Import",width:"0.4"}),i="import"+(new Date).getTime();e.setAttribute("onclick",i),window[i]=function(t){t.stopPropagation(),t instanceof CustomEvent&&Z()("#inputSceneFile").click()},t.appendChild(e)})(t),function(t){const e=g({value:"Export",width:"0.4"}),i="export"+(new Date).getTime();e.setAttribute("onclick",i),window[i]=function(t){t.stopPropagation(),t instanceof CustomEvent&&it()},t.appendChild(e)}(t),nt.appendChild(t)}()}class st{constructor(){this.createMenuContainer();const t=f("Scene");this.entityRef.appendChild(t),ot(this.entityRef),function(t){const e=m({value:"Multiselect"}),i="setWireframe"+(new Date).getTime();e.setAttribute("onclick",i);const n=o.getInstance();window[i]=function(t){if(t.stopPropagation(),t instanceof CustomEvent){const t=n.getMultiselectEnable();n.setMultiselectEnable(!t),t&&n.getSelectedFigures().forEach((t=>{N(t.htmlRef)}))}},t.appendChild(e)}(this.entityRef);const e=f("Multi");this.entityRef.appendChild(e),T(this.entityRef,null)}createMenuContainer(){this.entityRef=p({width:"1.3",height:"1.5",position:"-2.5 1 4.5",rotation:"0 90 0"});X.getInstance().getSceneEl().appendChild(this.entityRef)}}function rt(t){Z()("body").append(`<script src="./src/vendor/${t}.js"><\/script>`)}document.addEventListener("DOMContentLoaded",(function(t){console.log("DOM fully loaded");rt("ammo.wasm"),rt("aframe-physics-system.min"),document.getElementById("inputSceneFile").addEventListener("change",(function(){var t=new FileReader;t.onload=function(){et(t.result.toString())},t.readAsText(this.files[0])}));const e=X.getInstance().getSceneEl();new J({type:"directional",castShadow:!0,intensity:.98,shadowCameraVisible:!1,position:"1 2 1.8"});B(new K({id:l,height:3,width:5,rotation:"-90 0 0",material:{src:a.WOODEN,roughness:1},physics:{body:"static",shape:"box"}}),"-0.8 0.01 1.8",e),function(){const t={dependencies:["raycaster"],init:function(){const t=this.el;let e,i=null;const n=o.getInstance();this.el.addEventListener("click",(function(e){e.stopPropagation(),e instanceof MouseEvent&&(i?((new Date).getTime()-i<400&&(n.getMultiselectEnable()?N(t):t.childNodes[0].setAttribute("visible","true")),i=null):i=(new Date).getTime())})),this.el.addEventListener("mouseover",(function(i){e=function(t){const e=t.attributes;let i={};for(let t=0;t<e.length;t++){const n=e.item(t);i[n.nodeName]=n.nodeValue}return i}(t);const n=Number(null==e?void 0:e.opacity)-.2;t.setAttribute("opacity",n.toString())})),this.el.addEventListener("mouseleave",(function(i){const n=Number(t.getAttribute("opacity")),o=n!==Number(null==e?void 0:e.opacity)-.2?n:n+.2;t.setAttribute("opacity",o.toString())}))}};(0,n.registerComponent)(s,t)}();const i=[new q({"radius-bottom":.3,height:.8,color:"red"}),new G({radius:.3,height:.8,color:"blue"}),new U({radius:.3,color:"yellow"}),new V({height:.5,width:.5,depth:.5,color:"green"})];new Q({position:"0 2 0",rotation:"0 0 0"},i),new st}))}},i={};function n(t){var o=i[t];if(void 0!==o)return o.exports;var s=i[t]={id:t,loaded:!1,exports:{}};return e[t].call(s.exports,s,s.exports,n),s.loaded=!0,s.exports}n.m=e,t=[],n.O=(e,i,o,s)=>{if(!i){var r=1/0;for(l=0;l<t.length;l++){for(var[i,o,s]=t[l],c=!0,a=0;a<i.length;a++)(!1&s||r>=s)&&Object.keys(n.O).every((t=>n.O[t](i[a])))?i.splice(a--,1):(c=!1,s<r&&(r=s));c&&(t.splice(l--,1),e=o())}return e}s=s||0;for(var l=t.length;l>0&&t[l-1][2]>s;l--)t[l]=t[l-1];t[l]=[i,o,s]},n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{var t={143:0};n.O.j=e=>0===t[e];var e=(e,i)=>{var o,s,[r,c,a]=i,l=0;for(o in c)n.o(c,o)&&(n.m[o]=c[o]);for(a&&a(n),e&&e(i);l<r.length;l++)s=r[l],n.o(t,s)&&t[s]&&t[s][0](),t[r[l]]=0;n.O()},i=self.webpackChunkaframe_editor_scene=self.webpackChunkaframe_editor_scene||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var o=n.O(void 0,[614],(()=>n(306)));o=n.O(o)})();